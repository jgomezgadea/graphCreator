<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />

  <script src="../build/ros2d/easeljs.js"></script>
  <script src="../build/ros2d/eventemitter2.js"></script>
  <script src="../build/ros2d/roslib.js"></script>
  <script src="../build/ros2d/ros2d.js"></script>
  <script src="../build/mapView.js"></script>

  <script src="../build/vis/vis.js"></script>
  <script src="../build/graphView.js"></script>

  <link href="robotnik.css" rel="stylesheet" type="text/css" />

  <script>
    /**
     * Setup all visualization elements when the page is loaded.
     */
    var mapView;
    var nodes;
    var edges;
    var ros;

    function init() {

      // Connect to ROS
      ros = new ROSLIB.Ros({
        url: 'ws://localhost:9090'
      });

      /*nodes = new vis.DataSet([
        // TODO: Quitar ejemplo y trabajar por ROS
        { id: 1, label: 'Node 1' },
        { id: 2, label: 'Node 2' },
        { id: 3, label: 'Node 3' },
        { id: 4, label: 'Node 4' },
        { id: 5, label: 'Node 5' },
        { id: 6, label: 'Node 6' },
        { id: 7, label: 'Node 7' },
        { id: 8, label: 'Node 8' }
      ]);
      edges = new vis.DataSet([
        { from: 1, to: 8, arrows: 'to', dashes: true },
        { from: 1, to: 3, arrows: 'to' },
        { from: 1, to: 2, arrows: 'to, from' },
        { from: 2, to: 4, arrows: 'to, middle' },
        { from: 2, to: 5, arrows: 'to, middle, from' },
        { from: 5, to: 6, arrows: { to: { scaleFactor: 2 } } },
        { from: 6, to: 7, arrows: { middle: { scaleFactor: 0.5 }, from: true } }
      ]);*/

      mapView = new MAPVIEW.MapView({
        ros: ros,
        divID: 'map',
        width: canvas_views.clientWidth - 14,
        height: ((canvas_views.clientWidth - 14) * 9) / 16
      });

      graphView = new GRAPHVIEW.GraphView({
        divID: 'graph',
        ros: ros,
        rosNodesTopic: '/robotnik_fms_routes_node/graph',
        rosNodesMsg: 'graph_msgs/GraphNodeArray'
        //nodes: nodes,
        //edges: edges
      });

      graph.hidden = true;
    }

    // Change between map and graph
    function toggleView() {
      if (map.hidden) {
        graph.hidden = true;
        map.hidden = false;
        toggle_views.innerHTML = "View graph";
      } else {
        map.hidden = true;
        graph.hidden = false;
        graphView.stabilize();
        toggle_views.innerHTML = "View map";
        graphView.graph.setSize(canvas_views.clientWidth, (canvas_views.clientWidth * 9) / 16);
      }
    }

    // Scale the canvas to web
    function resizedCanvas() {
      mapView.scene.canvas.height = (canvas_views.clientWidth * 9) / 16;
      mapView.scene.canvas.width = canvas_views.clientWidth;
      graphView.graph.setSize(canvas_views.clientWidth, (canvas_views.clientWidth * 9) / 16);
    }

  </script>
</head>

<body onload="init()" onresize="resizedCanvas()">
  <h1>Robotnik 2D map</h1>

  <button id="toggle_views" type="button" onclick="toggleView()">View graph</button>

  <div id="canvas_views">
    <div id="map"></div>
    <div id="graph"></div>
  </div>

  <p>
    How to launch:
  </p>
  <ol>
    <tt>roslaunch graph_bringup graph_complete.launch</tt>
  </ol>

  <p>
    How to use the map:
  </p>
  <ol>
    <li><tt>Ctrl+click to create a point</tt></li>
    <li><tt>Ctrl+click and drag a point to move it</tt></li>
    <li><tt>Shift+click to delete a point</tt></li>
    <li><tt>Click and drag to move the map</tt></li>
    <li><tt>Use the mouse wheel to zoom the map</tt></li>
  </ol>
</body>

</html>